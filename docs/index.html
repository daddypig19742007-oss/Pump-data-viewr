<!DOCTYPE html> <html> <head> <meta charset="utf-8" /> <title>Pump Analysis Viewer</title> <meta name="viewport" content="width=device-width, initial-scale=1" /> <style> body { font-family: Arial, sans-serif; padding: 16px; max-width: 900px; margin: 0 auto; } label { display: block; margin-top: 8px; } .card { border: 1px solid #ccc; padding: 12px; margin-top: 12px; } </style> </head> <body> <h1>Pump Analysis Viewer</h1> <p>Enter a TAG NUMBER to load the latest measurement and calculations.</p> <div> <label>TAG NUMBER <input id="tagInput" placeholder="e.g., 1000" /> </label> <button id="loadBtn">Load</button> </div> <div id="results" class="card" style="display:none"></div> <script> const CSV_URL = 'PASTE_YOUR_SMARTSHEET_PUBLISHED_CSV_LINK_HERE'; const G = 9.80665; const ATM_kPa = 101.325; function rhoWater(tempC){ if (!Number.isFinite(tempC)) return 998.2; if (tempC <= 20) return 998.2; if (tempC >= 60) return 983.2; return 998.2 - ((tempC - 20) * (998.2 - 983.2) / 40); } function Pv_kPa(tempC){ if (!Number.isFinite(tempC)) return 2.34; if (tempC <= 20) return 2.34; if (tempC >= 60) return 19.9; return 2.34 + ((tempC - 20) * (19.9 - 2.34) / 40); } function kPaToHead(kPa, rho){ return (kPa * 1000) / (rho * G); } function tdh(dis_bar, suc_bar, rho, dz=0){ const dis_kPa = dis_bar * 100, suc_kPa = suc_bar * 100; return kPaToHead(dis_kPa - suc_kPa, rho) + dz; } function npsha(suc_bar, tempC, rho){ const suc_kPa = suc_bar * 100; return kPaToHead((suc_kPa + ATM_kPa - Pv_kPa(tempC)), rho); } function hydPower_W(rho, q_m3h, head_m){ return rho * G * (q_m3h/3600) * head_m; } function elecPower_W(V, A, pf=0.88){ if(!V||!A) return null; return Math.sqrt(3) * V * A * pf; } function hzToRPM(hz, poles=2){ if(!Number.isFinite(hz)) return ''; return Math.round(120 * hz / poles); } async function fetchCSV(){ const res = await fetch(CSV_URL); if (!res.ok) throw new Error(`CSV fetch failed: ${res.status}`); const text = await res.text(); const lines = text.trim().split('\n'); const header = lines.shift().split(','); return lines.map(line => { const vals = line.split(','); const obj = {}; header.forEach((h,i)=> obj[h.trim()] = (vals[i]||'').trim()); return obj; }); } function latestForTag(rows, tag){ const tgt = (tag||'').trim(); // Smartsheet header names must match your sheet/form const filtered = rows.filter(r => (r['TAG NUMBER']||'').trim() === tgt); filtered.sort((a,b)=> new Date(b['Created']||b['Timestamp']||0) - new Date(a['Created']||a['Timestamp']||0)); return filtered[0] || null; } function fmt(n, d=2){ return Number(n).toFixed(d); } function render(r){ const tempC = Number(r['TEMPERATURE']||''); const rho = rhoWater(tempC); const suc_bar = Number(r['SUCTION PRESSURE BAR']||0); const dis_bar = Number(r['DISCHARGE PRESSURE BAR']||0); const TDH = tdh(dis_bar, suc_bar, rho, 0); const NPSHa = npsha(suc_bar, tempC, rho); const flow_m3h = Number(r['FLOW M3/H']||''); const P_hyd_kW = Number.isFinite(flow_m3h) ? hydPower_W(rho, flow_m3h, TDH)/1000 : null; const V = Number(r['VOLTAGE (V)']||''); const A = Number(r['APPRX CURRENT']||''); const P_in_kW = (V && A) ? elecPower_W(V, A)/1000 : null; const eff = (P_hyd_kW && P_in_kW) ? (P_hyd_kW / P_in_kW * 100) : null; const hz = Number(r['APPROX SPEED']||''); const rpm = hzToRPM(hz, 2); // change to 4 for typical 4-pole motors if needed return ` <p><b>Timestamp</b>: ${r['Created']||r['Timestamp']||'-'}</p> <p><b>Pump</b>: ${r['PUMP MODEL']||'-'}; <b>Drive</b>: ${r['DRIVE TYPE']||'-'}; <b>Speed</b>: ${Number.isFinite(hz)?hz+' Hz':''} ${rpm?('('+rpm+' RPM approx)'):''}; <b>Fluid</b>: ${r['PROCESS FLUID']||'-'}</p> <p><b>Inputs</b>: Suction ${suc_bar} bar; Discharge ${dis_bar} bar; Temp ${tempC||'-'} °C; Flow ${flow_m3h||'-'} m³/h; Voltage ${V||'-'} V; Current ${A||'-'} A</p> <p><b>Calculated</b>: Density ${fmt(rho,1)} kg/m³; TDH ${fmt(TDH)} m; NPSHa ${fmt(NPSHa)} m; Hydraulic Power ${P_hyd_kW?fmt(P_hyd_kW):'—'} kW; Efficiency ${eff?fmt(eff,1):'—'}% </p> <p style="font-style:italic">TDH converts bar→kPa. NPSHa uses suction gauge + 101.325 kPa − vapor pressure. Efficiency is indicative.</p> `; } document.getElementById('loadBtn').addEventListener('click', async ()=>{ const tag = document.getElementById('tagInput').value.trim(); const out = document.getElementById('results'); if(!tag){ alert('Enter TAG NUMBER'); return; } try { const rows = await fetchCSV(); const r = latestForTag(rows, tag); out.style.display = 'block'; if(!r){ out.innerHTML = '<p>No data found for that TAG NUMBER.</p>'; return; } out.innerHTML = render(r); } catch (e) { out.style.display = 'block'; out.innerHTML = `<p>Error loading data: ${e.message}</p>`; } }); // Auto-load if ?tag= is in the URL const params = new URLSearchParams(location.search); const autoTag = params.get('tag'); if (autoTag) { document.getElementById('tagInput').value = autoTag; document.getElementById('loadBtn').click(); } </script> </body> </html>
